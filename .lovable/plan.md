

# خطة تطوير تطبيق بصيرة - الإصدار الشامل

هذه الوثيقة تغطي جميع التحسينات المطلوبة مقسّمة إلى مراحل تنفيذية واضحة. نظراً لحجم العمل الكبير، سيتم التنفيذ على **4 مراحل** متتالية.

---

## المرحلة 1: تحسين جودة الإجابات وتنسيقها

### 1.1 تحديث محرك الإجابات (Edge Function)
- تعديل `system prompt` في `islamic-search` ليتبع البنية: **عنوان - حكم - دليل - تفصيل**
- رفع `max_tokens` إلى 3000 للسماح بإجابات مفصلة
- إضافة تعليمات صريحة: "لا تختصر إلا إذا طلب المستخدم ذلك"
- تحسين التعليمات لضمان وضع الآيات بين `﴿ ﴾` والأحاديث بين `« »` دائماً

### 1.2 تحسين عرض الإجابات (ChatMessage)
- إضافة عنوان واضح للإجابة أعلى كل رد
- تقسيم الإجابة إلى فقرات منسقة بصرياً
- عرض الآيات القرآنية في "فقاعة خضراء" مميزة (خلفية خضراء شفافة مع حدود)
- عرض الأحاديث بلون أخضر فاتح مختلف
- تنسيق المصادر بشكل أنيق مع زر "عرض المصادر" القابل للطي

### 1.3 تحسين الواجهة العامة
- تحسين التباعد بين العناصر (padding/margin)
- إضافة انتقالات ناعمة (transitions) بين الصفحات
- تحسين البطاقات (ظلال خفيفة، حدود أنعم، تباعد موحّد)
- توحيد الهوامش في جميع الصفحات

---

## المرحلة 2: قسم القرآن الكريم المتكامل

### 2.1 صفحة قائمة السور (تحسين الحالية)
- الاحتفاظ بالتصميم الحالي مع تحسينات بصرية
- النقر على سورة يفتح صفحة عرض الآيات

### 2.2 صفحة عرض آيات السورة (جديدة)
- إنشاء `SurahViewPage.tsx` مع مسار `/quran/:surahId`
- جلب الآيات من API: `https://api.alquran.cloud/v2/surah/{id}/ar.alafasy`
- عرض كل آية مع رقمها بتصميم احترافي
- عند النقر على آية: عرض التفسير من `api.quran-tafseer.com`
- زر نسخ الآية

### 2.3 Edge Function للقرآن (جديدة)
- إنشاء `quran-api` edge function كوسيط لاستدعاء APIs القرآن الخارجية
- جلب الآيات والتفسير دون أي تعديل على النص
- دعم تعدد القراء (اختياري - يمكن إضافته لاحقاً)

---

## المرحلة 3: قسم الأذكار والأدعية (API خارجي + AI)

### 3.1 ربط الأذكار بـ API خارجي
- إنشاء `azkar-api` edge function لجلب الأذكار من Islamic APIs
- عرض النص كما هو بدون تعديل
- إعادة تصميم البطاقات مع:
  - عداد تكرار مع شريط تقدم دائري
  - زر مشاركة
  - عرض المصدر

### 3.2 قسم الأدعية المولّدة بالذكاء الاصطناعي
- إنشاء `duas-generator` edge function
- الذكاء الاصطناعي يعمل كـ **جامع ومنسق فقط** - يجلب أدعية من مصادر موثوقة
- منع تغيير صيغة الدعاء أو إعادة كتابته
- تمرير النص كما هو مع المصدر
- تحديث مستمر عبر Infinite scroll

---

## المرحلة 4: قسم التاريخ وأوقات الصلاة

### 4.1 صفحة أوقات الصلاة (جديدة)
- إنشاء `PrayerTimesPage.tsx` مع مسار `/prayer-times`
- إنشاء `prayer-times` edge function لجلب البيانات من `aladhan.com` API
- عرض:
  - التاريخ الهجري والميلادي
  - الساعة الحالية
  - أوقات الصلوات الخمس
  - اسم المدينة
  - حالة اليوم (جمعة، رمضان، إلخ)
- طلب إذن الموقع الجغرافي أو اختيار المدينة يدوياً

### 4.2 ربط بيانات الوقت بالذكاء الاصطناعي
- تمرير التاريخ والوقت الحالي للـ AI عند أسئلة متعلقة بالتاريخ أو أوقات الصلاة فقط

---

## التفاصيل التقنية

### Edge Functions الجديدة
```text
supabase/functions/
  islamic-search/    (تحديث - تحسين prompt)
  quran-api/         (جديد - وسيط لـ alquran.cloud + tafseer API)
  prayer-times/      (جديد - وسيط لـ aladhan.com API)
  duas-generator/    (جديد - AI كجامع أدعية فقط)
```

### صفحات جديدة
```text
src/pages/
  SurahViewPage.tsx   (عرض آيات السورة + التفسير)
  PrayerTimesPage.tsx (أوقات الصلاة + التاريخ)
```

### مسارات جديدة في App.tsx
```text
/quran/:surahId     -> SurahViewPage
/prayer-times       -> PrayerTimesPage
```

### ضوابط النظام المطبقة
1. جميع النصوص الشرعية (قرآن، حديث، أذكار) تُعرض كما هي من المصدر
2. الذكاء الاصطناعي يُستخدم فقط في: الشرح، التفصيل، التحليل، الإجابة الفقهية
3. قسم أوقات الصلاة هو القسم الوحيد الذي يزوّد AI ببيانات الوقت والتاريخ
4. لا تعديل أو إعادة صياغة لأي نص شرعي

### ترتيب التنفيذ المقترح
بسبب حجم العمل، يُنصح بتنفيذ كل مرحلة في رسالة منفصلة:
- **الرسالة 1**: المرحلة 1 (تحسين الإجابات + الواجهة)
- **الرسالة 2**: المرحلة 2 (القرآن الكريم المتكامل)
- **الرسالة 3**: المرحلة 3 (الأذكار والأدعية عبر API)
- **الرسالة 4**: المرحلة 4 (أوقات الصلاة والتاريخ)

